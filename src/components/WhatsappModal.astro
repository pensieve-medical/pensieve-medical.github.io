---
const whatsappMessage = 'ðŸ‘‹ Hi! I am interested in docco';
const whatsappPhone = '919226386487';
const encodedMessage = encodeURIComponent(whatsappMessage);
const whatsappLink = `https://wa.me/${whatsappPhone}?text=${encodedMessage}`;
const whatsappAppLink = `whatsapp://send?phone=${whatsappPhone}&text=${encodedMessage}`;
const qrLightSrc = '/qr/whatsapp-light.svg';
const qrDarkSrc = '/qr/whatsapp-dark.svg';
---
<div class="modal" id="whatsapp-modal" aria-hidden="true" role="dialog" aria-modal="true"
  data-whatsapp-link={whatsappLink} data-whatsapp-app-link={whatsappAppLink}>
  <div class="modal-content">
    <button class="modal-close" type="button" aria-label="Close" data-modal-close>Ã—</button>
    <h3>Contact Us Via Whatsapp</h3>
    <p>Scan QR code to contact us.</p>
    <div class="modal-qr">
      <img class="qr-image qr-image-dark" alt="WhatsApp QR code" src={qrDarkSrc} width="220" height="220" loading="lazy" />
      <img class="qr-image qr-image-light" alt="WhatsApp QR code" src={qrLightSrc} width="220" height="220" loading="lazy" />
    </div>
  </div>
</div>

<script is:inline>
  const modalTriggers = document.querySelectorAll('[data-modal-target]');
  const modalCloses = document.querySelectorAll('[data-modal-close]');
  const modals = document.querySelectorAll('.modal');
  const whatsappModal = document.getElementById('whatsapp-modal');
  const whatsappLink = whatsappModal?.dataset?.whatsappLink || '';
  const whatsappAppLink = whatsappModal?.dataset?.whatsappAppLink || '';

  const isPhoneDevice = () => {
    if (navigator.userAgentData && typeof navigator.userAgentData.mobile === 'boolean') {
      return navigator.userAgentData.mobile;
    }
    return /Android|iPhone|iPod|IEMobile|BlackBerry|Opera Mini|Windows Phone/i.test(navigator.userAgent);
  };

  const openModal = (modal) => {
    if (!modal) {
      return;
    }
    modal.classList.add('active');
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  };

  const closeModal = (modal) => {
    if (!modal) {
      return;
    }
    modal.classList.remove('active');
    modal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  };

  const openWhatsapp = () => {
    if (!whatsappAppLink) {
      return;
    }
    window.location.href = whatsappAppLink;
    window.setTimeout(() => {
      if (!document.hidden && whatsappModal) {
        openModal(whatsappModal);
      }
    }, 1200);
  };

  modalTriggers.forEach((trigger) => {
    trigger.addEventListener('click', () => {
      if (trigger.dataset.modalTarget === 'whatsapp-modal' && isPhoneDevice()) {
        openWhatsapp();
        return;
      }
      const modal = document.getElementById(trigger.dataset.modalTarget);
      openModal(modal);
    });
  });

  modalCloses.forEach((button) => {
    button.addEventListener('click', () => {
      const modal = button.closest('.modal');
      closeModal(modal);
    });
  });

  modals.forEach((modal) => {
    modal.addEventListener('click', (event) => {
      if (event.target === modal) {
        closeModal(modal);
      }
    });
  });

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      modals.forEach((modal) => closeModal(modal));
    }
  });
</script>
